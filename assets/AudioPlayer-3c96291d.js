import{r as e,j as t,f as r,b as n,m as c,g as a,h as u}from"./index-63a9563c.js";const s=({track:s,onEnded:i,autoPlay:o=!1,onAutoPlayComplete:l})=>{const[d,m]=e.useState(!1),[f,h]=e.useState(0),[x,p]=e.useState(0),[y,g]=e.useState(.7),[v,b]=e.useState(!1),[j,w]=e.useState([]),[N,S]=e.useState(null),A=e.useRef(null),E=e.useRef(null),F=e.useRef(null),C=e.useRef(null),R=e.useRef(null),k=e.useRef(!1),M=e.useRef(!o);e.useEffect((()=>{const e=window.AudioContext||window.webkitAudioContext;if(!F.current)try{F.current=new e,C.current=F.current.createAnalyser(),C.current.fftSize=64}catch(t){S("오디오 분석기를 초기화할 수 없습니다.")}return()=>{F.current&&(F.current.close().catch((e=>{})),F.current=null)}}),[]),e.useEffect((()=>{var e,t;if(p(0),h(0),S(null),M.current=!o,s&&s.audioFile&&A.current&&F.current&&C.current){if(R.current&&k.current){try{R.current.disconnect()}catch{}R.current=null,k.current=!1}if(C.current)try{C.current.disconnect()}catch{}if("closed"===F.current.state)return void S("오디오 컨텍스트가 닫혔습니다.");if(!k.current)try{if(A.current.readyState>=1||!k.current)R.current=F.current.createMediaElementSource(A.current),R.current.connect(C.current),C.current.connect(F.current.destination),k.current=!0;else{const r=()=>{var e,t;if(A.current&&F.current&&C.current&&!k.current&&"closed"!==F.current.state)try{R.current=F.current.createMediaElementSource(A.current),R.current.connect(C.current),C.current.connect(F.current.destination),k.current=!0}catch(n){"InvalidStateError"!==n.name&&S("오디오 소스를 연결할 수 없습니다."),k.current=!1}null==(e=A.current)||e.removeEventListener("canplay",r),null==(t=A.current)||t.removeEventListener("loadedmetadata",r)};null==(e=A.current)||e.addEventListener("canplay",r),null==(t=A.current)||t.addEventListener("loadedmetadata",r)}}catch(r){"InvalidStateError"!==r.name&&S("오디오 소스를 연결할 수 없습니다."),k.current=!1}}return()=>{if(R.current){try{R.current.disconnect()}catch{}R.current=null,k.current=!1}if(C.current)try{C.current.disconnect()}catch{}}}),[s]);const L=()=>{if(C.current&&d&&k.current){const t=C.current.frequencyBinCount,r=new Uint8Array(t);try{C.current.getByteFrequencyData(r);const e=Array.from(r).map((e=>e/255));w(e),E.current=requestAnimationFrame(L)}catch(e){E.current&&cancelAnimationFrame(E.current),E.current=null}}else E.current&&cancelAnimationFrame(E.current),E.current=null};e.useEffect((()=>{var e,t;d?(f>0||(null==(e=A.current)?void 0:e.readyState)>=2)&&(async()=>{if(A.current){if(F.current&&"suspended"===F.current.state)try{await F.current.resume()}catch(e){return S(`AudioContext 재개 실패: ${e.message}`),void m(!1)}try{S(null),await A.current.play(),C.current&&k.current&&!E.current&&(E.current=requestAnimationFrame(L))}catch(t){"AbortError"!==t.name&&(S(`오디오 재생 오류: ${t.message}`),m(!1)),E.current&&(cancelAnimationFrame(E.current),E.current=null)}}})():(null==(t=A.current)||t.pause(),E.current&&(cancelAnimationFrame(E.current),E.current=null))}),[d,f]),e.useEffect((()=>()=>{E.current&&cancelAnimationFrame(E.current)}),[]),e.useEffect((()=>{A.current&&(A.current.volume=v?0:y)}),[y,v]);const $=e=>{if(isNaN(e)||e===1/0||e<0)return"00:00";const t=Math.floor(e/60),r=Math.floor(e%60);return`${t.toString().padStart(2,"0")}:${r.toString().padStart(2,"0")}`};return t.jsxs("div",{className:"bg-primary bg-opacity-30 backdrop-blur-sm p-4 rounded-lg",children:[t.jsx("audio",{ref:A,src:null==s?void 0:s.audioFile,onLoadedMetadata:()=>{if(A.current){const e=A.current.duration;isFinite(e)?(h(e),S(null),o&&!M.current&&(m(!0),M.current=!0,"function"==typeof l&&l())):(S("오디오 길이를 가져올 수 없습니다."),h(0))}},onTimeUpdate:()=>{A.current&&p(A.current.currentTime)},onEnded:i,onError:e=>{S("오디오 파일을 로드하거나 재생할 수 없습니다."),m(!1)},crossOrigin:"anonymous"},null==s?void 0:s.audioFile),N&&t.jsx("div",{className:"bg-accent-magenta/20 border border-accent-magenta text-accent-magenta p-3 rounded-md mb-4 text-sm",children:N}),t.jsxs("div",{className:"flex items-center mb-4 "+(N?"opacity-50 pointer-events-none":""),children:[t.jsx("button",{onClick:()=>{F.current&&"suspended"===F.current.state&&F.current.resume().catch((e=>{S("오디오 컨텍스트 재개 실패")})),m(!d),S(null),M.current=!0,"function"==typeof l&&l()},className:"bg-accent-magenta hover:bg-opacity-80 text-white rounded-full w-10 h-10 flex items-center justify-center mr-4 focus:outline-none shadow-md hover:shadow-neon-magenta",disabled:!!N||!(null==s?void 0:s.audioFile),children:d?t.jsx(r,{}):t.jsx(n,{})}),t.jsxs("div",{className:"flex-1",children:[t.jsx("h3",{className:"text-white font-blender text-lg",children:null==s?void 0:s.title}),t.jsx("p",{className:"text-gray-400 text-sm",children:null==s?void 0:s.theme})]})]}),t.jsx("div",{className:"h-20 mb-4 flex items-end justify-center space-x-1 overflow-hidden "+(N?"opacity-30":""),children:j.length>0&&!N?j.map(((e,r)=>t.jsx(c.div,{className:"w-1.5 rounded-t",style:{background:"linear-gradient(to top, var(--color-accent-magenta), var(--color-accent-blue))",boxShadow:"0 0 2px rgba(33, 93, 255, 0.6), 0 0 5px rgba(180, 60, 255, 0.4)",height:`${Math.max(2,80*e)}%`,transformOrigin:"bottom",transition:"height 0.05s ease-out"}},r))):Array.from({length:32}).map(((e,r)=>t.jsx("div",{className:"w-1.5 h-1 bg-gray-700 rounded-t opacity-50"},r)))}),t.jsxs("div",{className:"mb-2 "+(N?"opacity-50 pointer-events-none":""),children:[t.jsxs("div",{className:"h-2 bg-gray-700 rounded-full cursor-pointer relative overflow-hidden group",onClick:N?void 0:e=>{if(!A.current||isNaN(f)||f<=0)return;const t=e.currentTarget.getBoundingClientRect(),r=(e.clientX-t.left)/t.width*f;A.current.currentTime=r,p(r)},children:[t.jsx("div",{className:"absolute top-0 left-0 h-full bg-gradient-to-r from-accent-magenta to-accent-blue transition-all duration-100 ease-linear",style:{width:x/f*100+"%"}}),t.jsx("div",{className:"absolute top-0 left-0 h-full bg-accent-blue blur opacity-0 group-hover:opacity-50 transition-opacity duration-200",style:{width:x/f*100+"%"}})]}),t.jsxs("div",{className:"flex justify-between text-xs text-gray-400 mt-1",children:[t.jsx("span",{children:$(x)}),t.jsx("span",{children:$(f)})]})]}),t.jsxs("div",{className:"flex items-center "+(N?"opacity-50 pointer-events-none":""),children:[t.jsx("button",{onClick:N?void 0:()=>{b(!v)},className:"text-gray-400 hover:text-accent-blue mr-2 focus:outline-none transition-colors",disabled:!!N,children:v?t.jsx(a,{}):t.jsx(u,{})}),t.jsx("input",{type:"range",min:"0",max:"1",step:"0.01",value:v?0:y,onChange:e=>{const t=parseFloat(e.target.value);g(t),b(0===t)},className:"w-24 h-1 bg-gray-700 rounded-full appearance-none cursor-pointer accent-accent-magenta",disabled:!!N})]})]})};export{s as A};
//# sourceMappingURL=AudioPlayer-3c96291d.js.map
